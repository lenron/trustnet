<!DOCTYPE HTML>
<html>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<body>

<center>
<h1>Simple Bitcoin Address Generator</h1>
</center>
<h2>Start with a mnemonic sentence:</h2>
<br>
<div>
Auto-Generate:
	<button id='gen_button' type="button" onclick="auto_generate()">Generate</button>
<br>
OR
<br>
Input your own (12 words please)!
	<input type="text" id="mnemonic_input_box" style="width: 700px; border-width: 1px; padding: 5px; font-family: courier"></input>
	<button id='go_button' type="button" onclick="go_user_input()">Go!</button>
<br>
Optional Seed Passphrase
	<input type='text' id='seed_pw'></input>
<br>
</div>

<div id='valididy_div'><label id='validity_label'>label</label></div>
<br><br>
<div id='result_div' style='display: none;'>
Bip32 Notation
	<input type="text" id="bip32_box" style="" value='m/0'></input>
	<button type='button' id='bip32_button' onclick='generate_results()'>Update</button>
	<label id='bip32_validity_label'><label> 
<br>
Extended Private Key
	<input type="text" id="result_prvkey_box" style="width: 550px; border-width: 1px; padding: 5px; font-family: courier"></input>
<br>
Address
	<input type="text" id="result_address_box" style="width: 300px; border-width: 1px; padding: 5px; font-family: courier"></input>
</div>

<script src="js_include_files/wordlist_english.js"></script>
<script src="js_include_files/crypto.js"></script>
<script src="js_include_files/noble-secp256k1.js"></script>
<script src="js_include_files/noble-ripemd160.js"></script>
<script>
// Ability check
console.log('test mnemonic word list: ' + wordListArray[1])
let secp = nobleSecp256k1;
let noble = nobleHashes;

function disable_inputs(){
	document.getElementById('gen_button').setAttribute('disabled', true);
	document.getElementById('go_button').setAttribute('disabled', true);
	document.getElementById('mnemonic_input_box').setAttribute('disabled', true);
	document.getElementById('seed_pw').setAttribute('disabled', true);
}

async function auto_generate(){
	//document.getElementById('mnemonic_input_box').value = 'hello world!';
	let generated_mnemonic = await computeMnemonicPhrase();
	document.getElementById('mnemonic_input_box').value = generated_mnemonic;
	document.getElementById('validity_label').innerHTML = 'Mnemonic sentence VALID. ';
	document.getElementById('result_div').style.display = 'inline';
	disable_inputs();
	generate_results();
}

async function go_user_input(){
	let mnemonic = document.getElementById('mnemonic_input_box').value;
	if( await verifyMnemonicPhrase(mnemonic) ){
		document.getElementById('validity_label').innerHTML = 'Mnemonic sentence VALID. ';
		document.getElementById('result_div').style.display = 'inline';
		disable_inputs();
		generate_results();
	}else if( mnemonic.split(' ').length != 12){
		document.getElementById('validity_label').innerHTML = 'This generator only takes mnemonic sentences of 12 words.';
	}else{
		document.getElementById('validity_label').innerHTML = 'Mnemonic sentence INVALID! Please enter a valid phrase or use the auto-generate feature.';
	}
}
async function generate_results(){
	document.getElementById('result_div').style.display = 'inline';
	let mnemonic = document.getElementById('mnemonic_input_box').value;
	let passphrase =  document.getElementById('seed_pw').value;
	let tree_str =  document.getElementById('bip32_box').value;

	let err = check_tree_input(tree_str);
	if( err !== ''){
		console.log('error: ' + err);
		document.getElementById('bip32_validity_label').innerHTML = err;
	}else{
		console.log('no error detected: ' + err);
/*
		result_array = await derive_key_tree(tree_str, mnemonic, passphrase);
		document.getElementById('bip32_box').value = tree_str;
		document.getElementById('result_prvkey_box').value = result_array[0];
		document.getElementById('result_address_box').value = result_array[2];
*/	
	}	

	result_array = await derive_key_tree(tree_str, mnemonic, passphrase);
	document.getElementById('bip32_box').value = tree_str;
	document.getElementById('result_prvkey_box').value = result_array[0];
	document.getElementById('result_address_box').value = result_array[2];

}

</script>

</body>
</html>
















